(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8520:function(e,s,l){Promise.resolve().then(l.bind(l,679))},679:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return ev}});var t=l(5444),a=l(9300),r=l(2191),i=l(3607);function n(...e){return(0,i.m6)((0,r.W)(e))}let c=a.forwardRef(({className:e,...s},l)=>(0,t.jsx)("div",{ref:l,className:n("panda-card",e),...s}));c.displayName="Card";let d=a.forwardRef(({className:e,...s},l)=>(0,t.jsx)("div",{ref:l,className:n("flex flex-col space-y-1.5 p-6",e),...s}));d.displayName="CardHeader";let o=a.forwardRef(({className:e,...s},l)=>(0,t.jsx)("h3",{ref:l,className:n("text-2xl font-semibold leading-none tracking-tight font-heading",e),...s}));o.displayName="CardTitle",a.forwardRef(({className:e,...s},l)=>(0,t.jsx)("p",{ref:l,className:n("text-sm text-muted-foreground",e),...s})).displayName="CardDescription";let u=a.forwardRef(({className:e,...s},l)=>(0,t.jsx)("div",{ref:l,className:n("p-6 pt-0",e),...s}));u.displayName="CardContent",a.forwardRef(({className:e,...s},l)=>(0,t.jsx)("div",{ref:l,className:n("flex items-center p-6 pt-0",e),...s})).displayName="CardFooter";var m=l(223),x=l(2371);let p=(0,x.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-95",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md hover:shadow-lg",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",panda:"panda-button"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),h=a.forwardRef(({className:e,variant:s,size:l,asChild:a=!1,...r},i)=>{let c=a?m.g7:"button";return(0,t.jsx)(c,{className:n(p({variant:s,size:l,className:e})),ref:i,...r})});h.displayName="Button";let f=a.forwardRef(({className:e,type:s,...l},a)=>(0,t.jsx)("input",{type:s,className:n("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...l}));f.displayName="Input";let g=(0,x.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function y({className:e,variant:s,...l}){return(0,t.jsx)("div",{className:n(g({variant:s}),e),...l})}var j=l(4624),N=l(8752),v=l(8274),b=l(9429),w=l(9211),C=l(3594),E=l(9062),T=l(101);let D={YELLOW:[1,2,3,4,5,6,7,8],PURPLE:[1,2,3,4,5,6,7,8,9,10,11,12],BLUE:[1,2,3,4,5,6,7,8,9,10,11,12],BLUE_GLITTER:[1,2,3,4,5,6],RED:[-4,-3,-2,-1,0,1,2,3,4,5,6,7,8],GREEN:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],CLEAR:[1,2,3,4,5,6],PINK:[1,2,3,4,5,6,7,8,9,10,11,12]};function S(e){return e>=2&&e<=3?1:e>=4&&e<=6?2:e>=7&&e<=9?3:10===e?4:1}let R="panda_royale_game";function L(e){try{localStorage.setItem(R,JSON.stringify(e))}catch(e){console.error("Failed to save game to localStorage:",e)}}function P(){try{let e=localStorage.getItem(R);if(!e)return null;let s=JSON.parse(e);return s.createdAt=new Date(s.createdAt),s}catch(e){return console.error("Failed to load game from localStorage:",e),null}}function I(e){let{diceType:s,diceCount:l,diceValues:t,hasGlitterDie:a=!1}=e;if(0===t.length)return{diceType:s,rawScore:0,multiplier:1,finalScore:0,description:"No dice rolled"};let r=t.reduce((e,s)=>e+s,0);switch(s){case"YELLOW":return{diceType:s,rawScore:r,multiplier:1,finalScore:r,description:`Yellow dice: ${t.join(" + ")} = ${r} points`};case"PURPLE":return{diceType:s,rawScore:r,multiplier:2,finalScore:2*r,description:`Purple dice: (${t.join(" + ")}) \xd7 2 = ${2*r} points`};case"BLUE":let i=a?2:1,n=r*i;return{diceType:s,rawScore:r,multiplier:i,finalScore:n,description:a?`Blue dice with Glitter: (${t.join(" + ")}) \xd7 2 = ${n} points`:`Blue dice: ${t.join(" + ")} = ${n} points`};case"BLUE_GLITTER":let c=2*r;return{diceType:s,rawScore:r,multiplier:2,finalScore:c,description:`Blue Glitter dice: (${t.join(" + ")}) \xd7 2 = ${c} points`};case"RED":let d=r*l;return{diceType:s,rawScore:r,multiplier:l,finalScore:d,description:`Red dice: (${t.join(" + ")}) \xd7 ${l} dice = ${d} points`};case"GREEN":case"CLEAR":case"PINK":return{diceType:s,rawScore:r,multiplier:1,finalScore:r,description:`${s.toLowerCase()} dice: ${t.join(" + ")} = ${r} points`};default:return{diceType:s,rawScore:0,multiplier:1,finalScore:0,description:"Unknown dice type"}}}function k(e){if(e.diceCount<0)return{valid:!1,error:"Dice count cannot be negative"};if(e.diceValues.length!==e.diceCount)return{valid:!1,error:"Number of dice values must match dice count"};let s=D[e.diceType];return e.diceValues.filter(e=>!s.includes(e)).length>0?{valid:!1,error:`${e.diceType} dice values must be between ${Math.min(...s)} and ${Math.max(...s)}${"RED"===e.diceType?" (including negative values)":""}`}:{valid:!0}}function G(e){return Math.max(...D[e])}function _(e,s){switch(s){case"YELLOW":return e.diceCollection.yellow;case"PURPLE":return e.diceCollection.purple;case"BLUE":return e.diceCollection.blue;case"BLUE_GLITTER":return e.diceCollection.blueGlitter;case"RED":return e.diceCollection.red;case"GREEN":return e.diceCollection.green;case"CLEAR":return e.diceCollection.clear;case"PINK":return e.diceCollection.pink;default:return 0}}function U(e,s,l){let t={...e.diceCollection},a=Math.max(0,l);switch(s){case"YELLOW":t.yellow=a;break;case"PURPLE":t.purple=a;break;case"BLUE":t.blue=a;break;case"BLUE_GLITTER":t.blueGlitter=a;break;case"RED":t.red=a;break;case"GREEN":t.green=a;break;case"CLEAR":t.clear=a;break;case"PINK":t.pink=a}return{...e,diceCollection:t}}function A(e,s,l){return 0===e.diceCollection.clear?{canTrade:!1,error:"No clear dice available to trade"}:"PINK"===l?{canTrade:!1,error:"Cannot trade for pink dice"}:0===_(s,l)?{canTrade:!1,error:`Target player has no ${l.toLowerCase()} dice to trade`}:{canTrade:!0}}function B(e){return e.currentRound>10||"FINISHED"===e.status}function O(e){return 0===e.length?null:[...e].sort((e,s)=>s.totalScore-e.totalScore)[0]||null}function $(e){return({YELLOW:"\uD83D\uDFE1",PURPLE:"\uD83D\uDFE3",BLUE:"\uD83D\uDD35",BLUE_GLITTER:"✨",RED:"\uD83D\uDD34",GREEN:"\uD83D\uDFE2",CLEAR:"⚪",PINK:"\uD83C\uDF38"})[e]||"⚫"}function F(e,s){let l=e.currentRound-1;return!(l<0)&&!(l>=e.roundScores.length)&&e.roundScores[l].some(e=>e.playerId===s)}function Y(e){let s=e.currentRound-1;return e.roundScores[s]||[]}var Z=l(9362),V=l(3485);let W=Z.fC;Z.xz;let M=Z.h_;Z.x8;let z=a.forwardRef(({className:e,...s},l)=>(0,t.jsx)(Z.aV,{ref:l,className:n("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));z.displayName=Z.aV.displayName;let H=a.forwardRef(({className:e,children:s,...l},a)=>(0,t.jsxs)(M,{children:[(0,t.jsx)(z,{}),(0,t.jsxs)(Z.VY,{ref:a,className:n("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...l,children:[s,(0,t.jsxs)(Z.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(V.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));H.displayName=Z.VY.displayName;let K=({className:e,...s})=>(0,t.jsx)("div",{className:n("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});K.displayName="DialogHeader";let q=({className:e,...s})=>(0,t.jsx)("div",{className:n("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});q.displayName="DialogFooter";let J=a.forwardRef(({className:e,...s},l)=>(0,t.jsx)(Z.Dx,{ref:l,className:n("text-lg font-semibold leading-none tracking-tight font-heading",e),...s}));function Q({diceType:e,selectedValues:s,onValueSelect:l,onValueDeselect:a,maxSelections:r,className:i}){let c=D[e]||[1,2,3,4,5,6],d=e=>{let t=s.filter(s=>s===e).length;s.length<r?l(e):t>0&&a(e)},o=e=>s.filter(s=>s===e).length,u=e=>{let l=o(e),t=s.length;return l>0||t<r};return(0,t.jsxs)("div",{className:n("space-y-3",i),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)("div",{className:`dice-indicator dice-${e.toLowerCase().replace("_","-")} w-6 h-6 text-sm`,children:$(e)}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Select ",r," ",e.replace("_"," ").toLowerCase()," dice values:"]}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",s.length,"/",r," selected)"]})]}),(0,t.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-6 lg:grid-cols-8 gap-2",children:c.map(s=>{let l=o(s),a=u(s),r=l>0;return(0,t.jsxs)(h,{variant:r?"default":"outline",size:"sm",onClick:()=>d(s),disabled:!a,className:n("relative h-12 w-12 flex flex-col items-center justify-center text-xs font-bold transition-all duration-200","RED"===e&&s<0&&"text-red-600 border-red-300","RED"===e&&0===s&&"text-yellow-600 border-yellow-300","RED"===e&&s>0&&"text-green-600 border-green-300",r&&"ring-2 ring-primary ring-offset-1",!a&&"opacity-50 cursor-not-allowed"),children:[(0,t.jsx)("span",{className:n("leading-none","RED"===e&&s<0&&"text-red-700","RED"===e&&0===s&&"text-yellow-700","RED"===e&&s>0&&"text-green-700"),children:s}),l>0&&(0,t.jsx)(y,{variant:"secondary",className:"absolute -top-1 -right-1 h-5 w-5 text-xs p-0 flex items-center justify-center",children:l})]},s)})}),"RED"===e&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground p-2 bg-muted/50 rounded",children:[(0,t.jsx)("span",{className:"font-medium",children:"Red dice:"})," Can have negative, zero, or positive values. Score = (sum of values) \xd7 (number of dice)"]}),s.length>0&&(0,t.jsxs)("div",{className:"flex flex-wrap gap-1 p-2 bg-primary/5 rounded",children:[(0,t.jsx)("span",{className:"text-xs font-medium",children:"Selected values:"}),s.map((s,l)=>(0,t.jsx)(y,{variant:"secondary",className:n("text-xs cursor-pointer hover:bg-destructive hover:text-destructive-foreground","RED"===e&&s<0&&"bg-red-100 text-red-700","RED"===e&&0===s&&"bg-yellow-100 text-yellow-700","RED"===e&&s>0&&"bg-green-100 text-green-700"),onClick:()=>a(s),title:"Click to remove",children:s},l))]})]})}function X({diceType:e,maxCount:s,selectedCount:l,onCountSelect:a,disabled:r=!1,className:i}){let c=Array.from({length:s+1},(e,s)=>s);return(0,t.jsxs)("div",{className:n("space-y-3",i),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)("div",{className:`dice-indicator dice-${e.toLowerCase().replace("_","-")} w-6 h-6 text-sm`,children:$(e)}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:["How many ",e.replace("_"," ").toLowerCase()," dice are you rolling?"]})]}),(0,t.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-6 lg:grid-cols-8 gap-2",children:c.map(e=>{let s=e===l;return(0,t.jsxs)(h,{variant:s?"default":"outline",size:"sm",onClick:()=>a(e),disabled:r,className:n("h-12 w-12 flex flex-col items-center justify-center text-sm font-bold transition-all duration-200",s&&"ring-2 ring-primary ring-offset-1"),children:[(0,t.jsx)("span",{className:"leading-none",children:e}),0===e&&(0,t.jsx)("span",{className:"text-xs opacity-75",children:"None"})]},e)})}),l>0&&(0,t.jsx)("div",{className:"flex items-center gap-2 p-2 bg-primary/5 rounded",children:(0,t.jsxs)(y,{variant:"secondary",className:"text-xs",children:["Rolling ",l," ",e.replace("_"," ").toLowerCase()," dice"]})})]})}J.displayName=Z.Dx.displayName,a.forwardRef(({className:e,...s},l)=>(0,t.jsx)(Z.dk,{ref:l,className:n("text-sm text-muted-foreground",e),...s})).displayName=Z.dk.displayName;var ee=l(3492);let es=[{type:"YELLOW",label:"Yellow"},{type:"PURPLE",label:"Purple"},{type:"BLUE",label:"Blue"},{type:"BLUE_GLITTER",label:"Blue Glitter"},{type:"RED",label:"Red"},{type:"GREEN",label:"Green"},{type:"CLEAR",label:"Clear"},{type:"PINK",label:"Pink"}];function el({open:e,onClose:s,onSubmit:l,player:r,existingScores:i=[]}){let[n,c]=(0,a.useState)("YELLOW"),[d,o]=(0,a.useState)([]),[u,m]=(0,a.useState)({diceType:"YELLOW",diceCount:0,diceValues:[],hasGlitterDie:!1,calculatedScore:0});a.useEffect(()=>{e&&i.length>0?o(i):e&&(o([]),m({diceType:n,diceCount:0,diceValues:[],hasGlitterDie:!1,calculatedScore:0}))},[e,i]);let x=_(r,n);G(n);let p=e=>{m(s=>({...s,...e}))},f=e=>{o(d.filter(s=>s.diceType!==e))},g=()=>{o([]),m({diceType:"YELLOW",diceCount:0,diceValues:[],hasGlitterDie:!1,calculatedScore:0}),s()},j=e=>{c(e);let s=d.find(s=>s.diceType===e);s?m(s):m({diceType:e,diceCount:0,diceValues:[],hasGlitterDie:!1,calculatedScore:0})},N=d.reduce((e,s)=>e+s.calculatedScore,0),v=u.diceCount>0&&u.diceValues.length===u.diceCount?I(u).finalScore:0;return(0,t.jsx)(W,{open:e,onOpenChange:g,children:(0,t.jsxs)(H,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)(K,{children:(0,t.jsxs)(J,{className:"flex items-center gap-2",children:["\uD83C\uDFB2 Enter Your Dice Scores",(0,t.jsxs)("span",{className:"text-sm font-normal text-muted-foreground",children:["(",r.name,")"]})]})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium mb-3",children:"Select Dice Type:"}),(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:es.map(({type:e,label:s})=>{let l=_(r,e);return(0,t.jsxs)(h,{variant:n===e?"default":"outline",onClick:()=>j(e),disabled:0===l,className:"h-auto flex flex-col gap-1 p-3",children:[(0,t.jsx)("div",{className:`dice-indicator dice-${e.toLowerCase().replace("_","-")} w-6 h-6 text-sm`,children:$(e)}),(0,t.jsx)("span",{className:"text-xs",children:s}),(0,t.jsx)(y,{variant:"secondary",className:"text-xs",children:l})]},e)})})]}),x>0&&(0,t.jsxs)("div",{className:"panda-card bg-secondary/20",children:[(0,t.jsxs)("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[(0,t.jsx)("div",{className:`dice-indicator dice-${n.toLowerCase().replace("_","-")} w-6 h-6 text-sm`,children:$(n)}),"Configure ",n.replace("_"," ").toLowerCase()," dice (max: ",x,")"]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(X,{diceType:n,maxCount:x,selectedCount:u.diceCount,onCountSelect:e=>{p({diceCount:e,diceValues:u.diceValues.slice(0,e)})}}),u.diceCount>0&&(0,t.jsx)(Q,{diceType:n,selectedValues:u.diceValues,onValueSelect:e=>{p({diceValues:[...u.diceValues,e]})},onValueDeselect:e=>{let s=u.diceValues.indexOf(e);if(-1!==s){let e=[...u.diceValues];e.splice(s,1),p({diceValues:e})}},maxSelections:u.diceCount,className:"mt-4"}),"BLUE"===n&&u.diceCount>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"glitter-die",checked:u.hasGlitterDie,onChange:e=>p({hasGlitterDie:e.target.checked}),className:"rounded"}),(0,t.jsxs)("label",{htmlFor:"glitter-die",className:"text-sm font-medium flex items-center gap-1",children:[(0,t.jsx)(ee.Z,{className:"w-4 h-4"}),"Glitter Die Rolled? (doubles the score)"]})]}),v>0&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Preview: ",I(u).description]}),u.diceCount>0&&u.diceValues.length===u.diceCount&&(0,t.jsx)(h,{onClick:()=>{let e=k(u);if(!e.valid){alert(e.error);return}let s=I(u),l={diceType:u.diceType,diceCount:u.diceCount,diceValues:u.diceValues,hasGlitterDie:u.hasGlitterDie||!1,calculatedScore:s.finalScore},t=d.findIndex(e=>e.diceType===u.diceType);if(t>=0){let e=[...d];e[t]=l,o(e)}else o([...d,l]);m({diceType:n,diceCount:0,diceValues:[],hasGlitterDie:!1,calculatedScore:0})},variant:"secondary",size:"sm",children:"Add This Entry"})]})]}),d.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium mb-3",children:"Your Scores:"}),(0,t.jsx)("div",{className:"space-y-2",children:d.map(e=>{let s=I(e);return(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:`dice-indicator dice-${e.diceType.toLowerCase().replace("_","-")} w-6 h-6 text-sm`,children:$(e.diceType)}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:e.diceType.replace("_"," ")}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:s.description})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("span",{className:"font-bold text-primary",children:["+",e.calculatedScore]}),(0,t.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>f(e.diceType),children:"Remove"})]})]},e.diceType)})})]}),(d.length>0||v>0)&&(0,t.jsx)("div",{className:"panda-card bg-primary/10 border-primary/30",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Round Total:"}),(0,t.jsx)("div",{className:"score-counter text-2xl text-primary",children:N+v})]})})]}),(0,t.jsxs)(q,{children:[(0,t.jsx)(h,{variant:"outline",onClick:g,children:"Cancel"}),(0,t.jsx)(h,{onClick:()=>{let e=[...d];if(u.diceCount>0&&u.diceValues.length===u.diceCount&&k(u).valid){let s=I(u),l={diceType:u.diceType,diceCount:u.diceCount,diceValues:u.diceValues,hasGlitterDie:u.hasGlitterDie||!1,calculatedScore:s.finalScore},t=e.findIndex(e=>e.diceType===u.diceType);t>=0?e[t]=l:e.push(l)}l(e),g()},disabled:0===d.length&&0===u.diceCount,children:"Submit Scores"})]})]})})}let et=[{type:"YELLOW",label:"Yellow",color:"dice-yellow"},{type:"PURPLE",label:"Purple",color:"dice-purple"},{type:"BLUE",label:"Blue",color:"dice-blue"},{type:"BLUE_GLITTER",label:"Blue Glitter",color:"dice-blue"},{type:"RED",label:"Red",color:"dice-red"},{type:"GREEN",label:"Green",color:"dice-green"},{type:"CLEAR",label:"Clear",color:"dice-clear"},{type:"PINK",label:"Pink",color:"dice-pink"}];function ea({player:e,onUpdateDiceCount:s,disabled:l=!1,showControls:a=!0}){let r=s=>{switch(s){case"YELLOW":return e.diceCollection.yellow;case"PURPLE":return e.diceCollection.purple;case"BLUE":return e.diceCollection.blue;case"BLUE_GLITTER":return e.diceCollection.blueGlitter;case"RED":return e.diceCollection.red;case"GREEN":return e.diceCollection.green;case"CLEAR":return e.diceCollection.clear;case"PINK":return e.diceCollection.pink;default:return 0}},i=l=>{let t=r(l);s(e.id,l,t+1)},n=l=>{let t=r(l);t>0&&s(e.id,l,t-1)},m=Object.values(e.diceCollection).reduce((e,s)=>e+s,0);return(0,t.jsxs)(c,{className:"w-full",children:[(0,t.jsx)(d,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(o,{className:"text-lg font-semibold",children:[e.name,e.hasPandaToken&&(0,t.jsx)(y,{variant:"outline",className:"ml-2 bg-yellow-100 text-yellow-800",children:"\uD83D\uDC3C Panda Token"})]}),(0,t.jsxs)(y,{variant:"secondary",className:"text-sm",children:["Total: ",m," dice"]})]})}),(0,t.jsx)(u,{children:(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:et.map(({type:e,label:s,color:c})=>{let d=r(e);return(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,t.jsx)("div",{className:`dice-indicator ${c} w-8 h-8 text-lg`,children:$(e)}),(0,t.jsx)("span",{className:"text-xs font-medium text-center",children:s}),a?(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(h,{variant:"outline",size:"sm",className:"h-6 w-6 p-0",onClick:()=>n(e),disabled:l||0===d,children:(0,t.jsx)(w.Z,{className:"h-3 w-3"})}),(0,t.jsx)("span",{className:"min-w-[24px] text-center font-semibold",children:d}),(0,t.jsx)(h,{variant:"outline",size:"sm",className:"h-6 w-6 p-0",onClick:()=>i(e),disabled:l,children:(0,t.jsx)(b.Z,{className:"h-3 w-3"})})]}):(0,t.jsx)(y,{variant:"outline",className:"text-xs",children:d})]},e)})})})]})}var er=l(7248),ei=l(2492),en=l(9032),ec=l(4693);function ed({label:e,players:s,selectedPlayerId:l,onPlayerSelect:a,excludePlayerIds:r=[],disabled:i=!1,allowNone:c=!0,className:d}){let o=s.filter(e=>!r.includes(e.id)),u=e=>{l===e?a(c?null:e):a(e)};return(0,t.jsxs)("div",{className:n("space-y-3",d),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)(ec.Z,{className:"h-4 w-4"}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:[e,":"]}),l&&(0,t.jsx)(y,{variant:"secondary",className:"text-xs",children:s.find(e=>e.id===l)?.name})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:[c&&(0,t.jsx)(h,{variant:null===l?"default":"outline",size:"sm",onClick:()=>u(null),disabled:i,className:"h-12 flex items-center justify-center text-sm transition-all duration-200",children:"None"}),o.map(e=>{let s=l===e.id;return(0,t.jsxs)(h,{variant:s?"default":"outline",size:"sm",onClick:()=>u(e.id),disabled:i,className:n("h-12 flex items-center justify-center gap-2 text-sm transition-all duration-200",s&&"ring-2 ring-primary ring-offset-1"),children:[(0,t.jsx)("span",{children:e.name}),e.hasPandaToken&&(0,t.jsx)(E.Z,{className:"h-3 w-3 text-yellow-600"})]},e.id)})]}),l&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground text-center",children:["Click the selected player again to ",c?"deselect":"change selection"]})]})}var eo=l(2984);function eu({label:e,availableDiceTypes:s,selectedDiceType:l,onDiceTypeSelect:a,disabled:r=!1,allowNone:i=!0,showCounts:c=!1,className:d}){let o=e=>{l===e?a(i?null:e):a(e)};return(0,t.jsxs)("div",{className:n("space-y-3",d),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)(eo.Z,{className:"h-4 w-4"}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:[e,":"]}),l&&(0,t.jsxs)(y,{variant:"secondary",className:"text-xs flex items-center gap-1",children:[(0,t.jsx)("span",{className:"text-sm",children:$(l)}),s.find(e=>e.type===l)?.label]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3",children:[i&&(0,t.jsx)(h,{variant:null===l?"default":"outline",size:"sm",onClick:()=>o(null),disabled:r,className:"h-16 flex flex-col items-center justify-center text-xs transition-all duration-200",children:(0,t.jsx)("span",{children:"None"})}),s.map(e=>{let s=l===e.type;return(0,t.jsxs)(h,{variant:s?"default":"outline",size:"sm",onClick:()=>o(e.type),disabled:r,className:n("h-16 flex flex-col items-center justify-center gap-1 text-xs transition-all duration-200",s&&"ring-2 ring-primary ring-offset-1"),children:[(0,t.jsx)("div",{className:`dice-indicator dice-${e.type.toLowerCase().replace("_","-")} w-8 h-8 text-lg`,children:$(e.type)}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"font-medium",children:e.label}),c&&void 0!==e.count&&(0,t.jsx)(y,{variant:"secondary",className:"text-xs mt-1",children:e.count})]})]},e.type)})]}),l&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground text-center",children:["Click the selected dice type again to ",i?"deselect":"change selection"]})]})}function em({players:e,tradingSession:s,onExecuteTrade:l,onMarkPlayerComplete:r,disabled:i=!1}){let[n,m]=(0,a.useState)({}),x=(e,s)=>{m(l=>({...l,[e]:{playerId:e,selectedTargetPlayer:l[e]?.selectedTargetPlayer||null,selectedDiceType:l[e]?.selectedDiceType||null,...s}}))},p=e=>[{type:"YELLOW",label:"Yellow"},{type:"PURPLE",label:"Purple"},{type:"BLUE",label:"Blue"},{type:"BLUE_GLITTER",label:"Blue Glitter"},{type:"RED",label:"Red"},{type:"GREEN",label:"Green"},{type:"CLEAR",label:"Clear"}].filter(s=>{let l=e.diceCollection;switch(s.type){case"YELLOW":return l.yellow>0;case"PURPLE":return l.purple>0;case"BLUE":return l.blue>0;case"BLUE_GLITTER":return l.blueGlitter>0;case"RED":return l.red>0;case"GREEN":return l.green>0;case"CLEAR":return l.clear>0;default:return!1}}),f=e=>{let s=n[e];s?.selectedTargetPlayer&&s?.selectedDiceType&&(l(e,s.selectedTargetPlayer,s.selectedDiceType),x(e,{selectedTargetPlayer:null,selectedDiceType:null}))},g=(e,s)=>{x(e,{selectedTargetPlayer:s,selectedDiceType:null})};return 0===s.activePlayers.length?(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsxs)(o,{className:"flex items-center gap-2",children:[(0,t.jsx)(j.Z,{className:"h-5 w-5"}),"Multi-Player Trading"]})}),(0,t.jsx)(u,{children:(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"No players have clear dice available for trading"})})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsxs)(o,{className:"flex items-center gap-2",children:[(0,t.jsx)(j.Z,{className:"h-5 w-5"}),"Multi-Player Trading Session"]}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Players with clear dice can trade simultaneously"})]}),(0,t.jsx)(u,{children:(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:s.activePlayers.map(s=>{let l=e.find(e=>e.id===s.playerId);return l?(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-semibold mx-auto mb-2",children:l.name.charAt(0).toUpperCase()}),(0,t.jsx)("div",{className:"text-sm font-medium truncate",children:l.name}),(0,t.jsx)("div",{className:"flex items-center justify-center gap-1 mt-1",children:s.isDone?(0,t.jsxs)(y,{variant:"secondary",className:"text-xs",children:[(0,t.jsx)(er.Z,{className:"w-3 h-3 mr-1"}),"Done"]}):s.tradesRemaining>0?(0,t.jsxs)(y,{variant:"default",className:"text-xs",children:[(0,t.jsx)(ei.Z,{className:"w-3 h-3 mr-1"}),s.tradesRemaining," left"]}):(0,t.jsx)(y,{variant:"outline",className:"text-xs",children:"No trades"})})]},s.playerId):null})})})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:s.activePlayers.filter(e=>!e.isDone&&e.tradesRemaining>0).map(s=>{let l=e.find(e=>e.id===s.playerId),a=n[s.playerId],m=a?.selectedTargetPlayer?e.find(e=>e.id===a.selectedTargetPlayer):null,j=m?p(m):[],N=e.filter(e=>e.id!==s.playerId),v=m&&a?.selectedDiceType?A(l,m,a.selectedDiceType):{canTrade:!1,error:a?.selectedTargetPlayer?"Select a dice type to trade for":"Select a target player"};return l?(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsxs)(o,{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-6 h-6 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-xs font-bold",children:l.name.charAt(0).toUpperCase()}),l.name,"'s Trading"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsxs)(y,{variant:"outline",className:"dice-clear",children:[$("CLEAR")," Clear dice: ",l.diceCollection.clear]}),(0,t.jsxs)(y,{variant:"secondary",children:[s.tradesRemaining," trades remaining"]})]})]}),(0,t.jsxs)(u,{className:"space-y-4",children:[(0,t.jsx)(ed,{label:"Trade with player",players:N,selectedPlayerId:a?.selectedTargetPlayer||null,onPlayerSelect:e=>g(s.playerId,e),disabled:i,allowNone:!1}),a?.selectedTargetPlayer&&j.length>0&&(0,t.jsx)(eu,{label:"Request dice type",availableDiceTypes:j,selectedDiceType:a?.selectedDiceType||null,onDiceTypeSelect:e=>x(s.playerId,{selectedDiceType:e}),disabled:i,allowNone:!1}),a?.selectedTargetPlayer&&0===j.length&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded-lg text-center",children:[m?.name," has no dice available for trading (excluding pink dice)"]}),a?.selectedTargetPlayer&&a?.selectedDiceType&&(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 py-3 bg-muted rounded-lg",children:[(0,t.jsxs)(y,{variant:"outline",className:"dice-clear",children:[$("CLEAR")," Clear"]}),(0,t.jsx)(en.Z,{className:"h-4 w-4"}),(0,t.jsxs)(y,{variant:"outline",className:`dice-${a.selectedDiceType.toLowerCase().replace("_","-")}`,children:[$(a.selectedDiceType)," ",a.selectedDiceType.replace("_"," ")]})]}),!v.canTrade&&v.error&&(0,t.jsx)("div",{className:"text-sm text-destructive bg-destructive/10 p-3 rounded",children:v.error}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(h,{onClick:()=>f(s.playerId),disabled:i||!v.canTrade,className:"flex-1",children:["Execute Trade",a?.selectedTargetPlayer&&a?.selectedDiceType&&` (Clear → ${a.selectedDiceType.replace("_"," ")})`]}),(0,t.jsx)(h,{variant:"outline",onClick:()=>r(s.playerId),disabled:i,children:"Done Trading"})]})]})]},s.playerId):null})}),s.isComplete&&(0,t.jsx)(c,{className:"bg-green-50 border-green-200",children:(0,t.jsx)(u,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,t.jsx)(v.Z,{className:"h-6 w-6 text-green-600"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"font-semibold text-green-800",children:"Trading Phase Complete!"}),(0,t.jsx)("div",{className:"text-sm text-green-600",children:"All players have finished trading or have no trades remaining"})]})]})})})]})}var ex=l(1501),ep=l(6488);function eh({diceBag:e,players:s,currentTurnPlayerId:l,onSelectDie:r,disabled:i=!1}){let[n,m]=(0,a.useState)(null),[x,p]=(0,a.useState)(null),f=s.find(e=>e.id===l);if(!f)return(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsxs)(o,{className:"flex items-center gap-2",children:[(0,t.jsx)(ex.Z,{className:"h-5 w-5"}),"Dice Selection"]})}),(0,t.jsx)(u,{children:(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"Player not found"})})]});let g=[{type:"YELLOW",label:"Yellow",count:e.yellow},{type:"PURPLE",label:"Purple",count:e.purple},{type:"BLUE",label:"Blue",count:e.blue},{type:"BLUE_GLITTER",label:"Blue Glitter",count:e.blueGlitter},{type:"RED",label:"Red",count:e.red},{type:"GREEN",label:"Green",count:e.green},{type:"CLEAR",label:"Clear",count:e.clear}].filter(e=>e.count>0);return 0===g.length?(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsxs)(o,{className:"flex items-center gap-2",children:[(0,t.jsx)(ex.Z,{className:"h-5 w-5"}),"Dice Selection Complete"]})}),(0,t.jsx)(u,{children:(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"No more dice available in the bag"})})]}):(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsxs)(o,{className:"flex items-center gap-2",children:[(0,t.jsx)(ex.Z,{className:"h-5 w-5"}),"Free Dice Selection"]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[f.name,"'s turn to select a die"]})]}),(0,t.jsxs)(u,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)(E.Z,{className:"h-4 w-4 text-yellow-600"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Current Turn:"}),(0,t.jsxs)(y,{variant:f.hasPandaToken?"default":"secondary",children:[f.name,f.hasPandaToken&&" \uD83D\uDC3C"]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(eu,{label:"Choose any available dice color",availableDiceTypes:g,selectedDiceType:n,onDiceTypeSelect:m,disabled:i,allowNone:!1,showCounts:!0}),n&&(0,t.jsxs)("div",{className:"space-y-4 p-4 bg-muted/30 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ep.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Optional: Set maximum value"})]}),(0,t.jsx)(X,{diceType:n||"YELLOW",selectedCount:x||0,maxCount:G(n||"YELLOW"),onCountSelect:e=>p(0===e?null:e),disabled:i}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Setting a maximum value means your die will only have values from 1 to that maximum.",null===x&&" No limit means the full range is available."]})]}),n&&(0,t.jsxs)(h,{onClick:()=>{n&&(r(l,n,x||void 0),m(null),p(null))},disabled:i,className:"w-full",children:["Select ",n.replace("_"," ").toLowerCase()," die",x&&` (max ${x})`]})]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground text-center",children:"Selection order based on yellow dice scores (highest to lowest)"})]})]})}var ef=l(6886),eg=l(4907),ey=l(6124);let ej={ROLLING:{icon:ex.Z,title:"Rolling & Scoring",description:"Players roll dice and enter scores",nextPhase:"PITY_DICE",buttonText:"Distribute Pink Dice"},PITY_DICE:{icon:ef.Z,title:"Pink Dice Distribution",description:"Redistribute pink pity dice to lowest scoring players",nextPhase:"TRADING",buttonText:"Start Trading Phase"},TRADING:{icon:j.Z,title:"Dice Trading",description:"Players can trade dice using clear dice",nextPhase:"NEW_DICE",buttonText:"Select New Dice"},NEW_DICE:{icon:eg.Z,title:"New Dice Selection",description:"Players select new dice from the bag",nextPhase:"RESULTS",buttonText:"View Round Results"},RESULTS:{icon:v.Z,title:"Round Results",description:"Review round results and advance to next round",nextPhase:"ROLLING",buttonText:"Next Round"}};function eN({game:e,onAdvancePhase:s,canAdvance:l,disabled:a=!1}){if("SETUP"===e.phase||"GAME_COMPLETE"===e.phase)return null;let r=ej[e.phase];if(!r)return null;let{icon:i,title:n,description:m,nextPhase:x,buttonText:p}=r;return(0,t.jsxs)(c,{className:"bg-primary/5 border-primary/20",children:[(0,t.jsxs)(d,{className:"pb-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i,{className:"h-5 w-5 text-primary"}),(0,t.jsx)(o,{className:"text-lg",children:n})]}),(0,t.jsxs)(y,{variant:"outline",className:"bg-primary/10 text-primary",children:["Round ",e.currentRound," of 10"]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:m})]}),(0,t.jsx)(u,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(ey.Z,{className:`h-4 w-4 ${l?"text-green-600":"text-gray-400"}`}),l?"Ready to advance":"Waiting for completion"]}),(0,t.jsxs)(h,{onClick:()=>{"RESULTS"===e.phase&&e.currentRound>=10?s("GAME_COMPLETE"):s(x)},disabled:a||!l,className:"flex items-center gap-2",children:[p,(0,t.jsx)(en.Z,{className:"h-4 w-4"})]})]})})]})}function ev(){let[e,s]=(0,a.useState)("SETUP"),[l,r]=(0,a.useState)(["",""]),[i,n]=(0,a.useState)(null),[m,x]=(0,a.useState)(!1),[p,g]=(0,a.useState)(null),[D,k]=(0,a.useState)(""),[G,$]=(0,a.useState)("");(0,a.useEffect)(()=>{if(function(){let e=P();return null!==e&&"FINISHED"!==e.status}()){let e=P();e&&(n(e),s("FINISHED"===e.status?"FINISHED":"PLAYING"))}},[]);let Z=S(l.filter(e=>e.trim()).length),V=e=>{l.length>2&&r(l.filter((s,l)=>l!==e))},W=(e,s)=>{let t=[...l];t[e]=s,r(t)},M=()=>{confirm("Are you sure you want to reset the game? All progress will be lost.")&&(!function(){try{localStorage.removeItem(R)}catch(e){console.error("Failed to clear game from localStorage:",e)}}(),n(null),s("SETUP"),r(["",""]),x(!1),g(null),k(""),$(""))},z=e=>{g(e),x(!0)},H=(e,s,l)=>{if(i)try{let t=i.players.find(s=>s.id===e);if(!t)return;let a=U(t,s,l),r={...i,players:i.players.map(s=>s.id===e?a:s)};n(r)}catch(e){alert(e instanceof Error?e.message:"Failed to update dice count")}};if("SETUP"===e)return(0,t.jsx)("div",{className:"min-h-screen purple-gradient-pattern flex items-center justify-center py-8",children:(0,t.jsx)("div",{className:"container-panda",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl mx-auto space-y-8",children:[(0,t.jsxs)("div",{className:"text-center space-y-4",children:[(0,t.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC3C"}),(0,t.jsx)("h1",{className:"text-4xl font-bold font-heading text-balance",children:"Panda Royale"}),(0,t.jsx)("p",{className:"text-lg text-muted-foreground text-balance",children:"Enhanced dice management with end-of-round mechanics"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[(0,t.jsxs)("div",{className:"panda-card py-6",children:[(0,t.jsx)(j.Z,{className:"w-8 h-8 mx-auto mb-2 text-primary"}),(0,t.jsx)("h3",{className:"font-semibold",children:"2-10 Players"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enhanced dice collections"})]}),(0,t.jsxs)("div",{className:"panda-card py-6",children:[(0,t.jsx)(N.Z,{className:"w-8 h-8 mx-auto mb-2 text-primary"}),(0,t.jsx)("h3",{className:"font-semibold",children:"Multi-Phase Rounds"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Score, trade, select new dice"})]}),(0,t.jsxs)("div",{className:"panda-card py-6",children:[(0,t.jsx)(v.Z,{className:"w-8 h-8 mx-auto mb-2 text-primary"}),(0,t.jsx)("h3",{className:"font-semibold",children:"Official Rules"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Complete rulebook implementation"})]})]}),(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsxs)(o,{className:"flex items-center gap-2",children:[(0,t.jsx)(b.Z,{className:"w-5 h-5"}),"Setup New Game"]})}),(0,t.jsxs)(u,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Player Names (",2,"-",10," players)"]}),(0,t.jsx)("div",{className:"space-y-2",children:l.map((e,s)=>(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(f,{placeholder:`Player ${s+1}`,value:e,onChange:e=>W(s,e.target.value),className:"flex-1"}),s>=2&&(0,t.jsx)(h,{variant:"outline",size:"icon",onClick:()=>V(s),children:(0,t.jsx)(w.Z,{className:"w-4 h-4"})})]},s))}),l.length<10&&(0,t.jsxs)(h,{variant:"outline",onClick:()=>{l.length<10&&r([...l,""])},className:"w-full mt-2",children:[(0,t.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),"Add Player"]})]}),(0,t.jsx)("div",{className:"panda-card bg-secondary/20",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("strong",{children:"Pink Dice Count:"})," ",Z," pink dice",(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"Redistributed each round to lowest scoring players"})]})}),(0,t.jsx)(h,{onClick:()=>{let e=l.filter(e=>e.trim());if(e.length<2){alert("Need at least 2 players to start a game");return}if([...new Set(e)].length!==e.length){alert("All player names must be unique");return}n(function(e){let s=e.map((e,s)=>({id:`player_${s+1}`,name:e.trim(),totalScore:0,pandaTokens:0,diceCollection:{yellow:1,purple:0,blue:0,blueGlitter:0,red:0,green:0,clear:0,pink:0},yellowScoreThisRound:0,hasPandaToken:0===s})),l={yellow:9,purple:14,blue:25,blueGlitter:7,red:19,green:10,clear:7,pink:0};l.yellow=Math.max(0,l.yellow-e.length+1);let t={id:`game_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,currentRound:1,status:"PLAYING",phase:"ROLLING",pityDiceCount:S(s.length),createdAt:new Date,players:s,roundScores:[],diceBag:l,availableDicePool:[],pandaTokenHolder:s[0]?.id||null};return L(t),t}(e)),s("PLAYING")},disabled:l.filter(e=>e.trim()).length<2,className:"w-full",children:"Start Game"})]})]}),(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsx)(o,{children:"Enhanced Game Features"})}),(0,t.jsx)(u,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold mb-2",children:"End-of-Round Phases:"}),(0,t.jsxs)("ul",{className:"space-y-1 text-muted-foreground",children:[(0,t.jsxs)("li",{children:["\uD83C\uDFB2 ",(0,t.jsx)("strong",{children:"Roll & Score:"})," Enter dice results"]}),(0,t.jsxs)("li",{children:["\uD83C\uDF38 ",(0,t.jsx)("strong",{children:"Pink Dice:"})," Auto-redistribute to lowest scores"]}),(0,t.jsxs)("li",{children:["\uD83D\uDD04 ",(0,t.jsx)("strong",{children:"Trading:"})," Trade clear dice for others"]}),(0,t.jsxs)("li",{children:["\uD83C\uDFAF ",(0,t.jsx)("strong",{children:"New Dice:"})," Select from bag by yellow score order"]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold mb-2",children:"Dice Collection Management:"}),(0,t.jsxs)("ul",{className:"space-y-1 text-muted-foreground",children:[(0,t.jsx)("li",{children:"\uD83D\uDCE6 Track individual dice collections"}),(0,t.jsx)("li",{children:"\uD83D\uDC3C Panda token for highest yellow scores"}),(0,t.jsx)("li",{children:"\uD83D\uDC8E Easy dice count adjustments"}),(0,t.jsx)("li",{children:"\uD83C\uDFAA Visual dice type indicators"})]})]})]})})]})]})})});if(!i)return null;let K=[...i.players].sort((e,s)=>s.totalScore!==e.totalScore?s.totalScore-e.totalScore:s.pandaTokens-e.pandaTokens),q=Y(i),J=i.players.every(e=>F(i,e.id)),Q=i.players.find(e=>e.hasPandaToken);return(0,t.jsx)("div",{className:"min-h-screen purple-gradient-pattern",children:(0,t.jsxs)("div",{className:"container-panda py-6",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-primary flex items-center gap-2",children:"\uD83D\uDC3C Panda Royale"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:function(e){switch(e.status){case"SETUP":return"Setting up game...";case"PLAYING":return`Round ${e.currentRound} of 10 - ${function(e){switch(e){case"SETUP":return"Setting up game...";case"ROLLING":return"Roll dice and enter scores";case"PITY_DICE":return"Redistributing pink pity dice";case"TRADING":return"Trade dice using clear dice";case"NEW_DICE":return"Select new dice from bag";case"RESULTS":return"Round complete - view results";case"GAME_COMPLETE":return"Game finished!";default:return"Unknown phase"}}(e.phase)}`;case"FINISHED":return"Game Complete!";default:return"Unknown status"}}(i)})]}),(0,t.jsxs)(h,{variant:"outline",onClick:M,children:[(0,t.jsx)(C.Z,{className:"w-4 h-4 mr-2"}),"Reset Game"]})]}),"GAME_COMPLETE"!==i.phase&&(0,t.jsx)(eN,{game:i,onAdvancePhase:e=>{if(i)try{let l={...i};switch(e){case"PITY_DICE":l=function(e){let s=e.currentRound-1,l=e.roundScores[s]||[];if(l.length!==e.players.length)throw Error("Cannot redistribute pink dice until all players have submitted scores");let t={...e};t.players=e.players.map(e=>({...e,diceCollection:{...e.diceCollection,pink:0}}));let a=l.map(e=>({playerId:e.playerId,playerName:e.playerName,roundScore:e.roundTotal})).sort((e,s)=>e.roundScore-s.roundScore),r=e.pityDiceCount,i=0,n=0;for(;i<r&&n<a.length;){let s=a[n].roundScore,l=a.filter(e=>e.roundScore===s),c=r-i;if(l.length<=c)for(let e of l){let s=t.players.find(s=>s.id===e.playerId);s&&0===s.diceCollection.pink&&(s.diceCollection.pink=1,i++)}else{let s=e.pandaTokenHolder,a=t.players.findIndex(e=>e.id===s);if(-1!==a){let e=[];for(let s=1;s<=t.players.length;s++){let l=(a+s)%t.players.length;e.push(t.players[l])}for(let s of e){if(i>=r)break;l.some(e=>e.playerId===s.id)&&0===s.diceCollection.pink&&(s.diceCollection.pink=1,i++)}}}if(-1===(n=a.findIndex(e=>e.roundScore>s)))break}return t}(l),l=function(e){let s=e.currentRound-1,l=e.roundScores[s]||[];if(l.length!==e.players.length)throw Error("Cannot update panda token until all players have submitted scores");return function(e,s){let l={...e,pandaTokenHolder:s,players:e.players.map(e=>({...e,hasPandaToken:e.id===s}))};return L(l),l}(e,function(e){if(0===e.length)return null;let s=Math.max(...e.map(e=>e.yellowScore)),l=e.filter(e=>e.yellowScore===s);return l[0]?.playerId||null}(l.map(e=>({playerId:e.playerId,yellowScore:e.yellowScore}))))}(l);break;case"TRADING":l=function(e){let s=e.players.filter(e=>e.diceCollection.clear>0).map(e=>({playerId:e.id,playerName:e.name,clearDiceCount:e.diceCollection.clear,maxTrades:e.diceCollection.clear,tradesRemaining:e.diceCollection.clear,isActive:!0,isDone:!1,completedTrades:[]})),l={activePlayers:s,isComplete:0===s.length,canAdvance:0===s.length},t={...e,currentTradingSession:l};return L(t),t}(l),k("");break;case"NEW_DICE":let t=Y(l).sort((e,s)=>s.yellowScore-e.yellowScore);t.length>0&&$(t[0]?.playerId||"");break;case"RESULTS":let a=l.currentRound-1,r=l.roundScores[a]||[];l.players=l.players.map(e=>{let s=r.find(s=>s.playerId===e.id);return{...e,totalScore:e.totalScore+(s?.roundTotal||0)}});break;case"ROLLING":l.currentRound>=10?(l.status="FINISHED",l.phase="GAME_COMPLETE",s("FINISHED")):l=function(e){let s={...e,currentRound:e.currentRound+1,phase:"ROLLING",availableDicePool:[],players:e.players.map(e=>({...e,yellowScoreThisRound:0}))};return L(s),s}(l);break;case"GAME_COMPLETE":l.status="FINISHED",s("FINISHED")}"ROLLING"!==e&&(l=function(e,s){let l={...e,phase:s};return L(l),l}(l,e)),n(l)}catch(e){alert(e instanceof Error?e.message:"Failed to advance phase")}},canAdvance:(()=>{switch(i.phase){case"ROLLING":return J;case"PITY_DICE":case"NEW_DICE":case"RESULTS":return!0;case"TRADING":return i.currentTradingSession?.isComplete??!0;default:return!1}})()}),Q&&(0,t.jsx)(c,{className:"bg-yellow-50 border-yellow-200",children:(0,t.jsx)(u,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,t.jsx)(E.Z,{className:"h-6 w-6 text-yellow-600"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"font-semibold text-yellow-800",children:[Q.name," holds the Panda Token! \uD83D\uDC3C"]}),(0,t.jsxs)("div",{className:"text-sm text-yellow-600",children:[Q.pandaTokens," token",1!==Q.pandaTokens?"s":""," earned"]})]})]})})}),"ROLLING"===i.phase&&(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsx)(o,{children:"Enter Player Scores"})}),(0,t.jsx)(u,{children:(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3",children:i.players.map(e=>{let s=F(i,e.id);return(0,t.jsxs)(h,{variant:s?"secondary":"outline",onClick:()=>z(e),className:"h-auto py-4 flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-semibold",children:e.name.charAt(0).toUpperCase()}),(0,t.jsx)("span",{className:"text-sm font-medium truncate",children:e.name}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,t.jsx)(T.Z,{className:"w-3 h-3"}),s?"✓ Edit Scores":"Enter Scores"]}),s&&(0,t.jsx)("div",{className:"text-xs text-green-600",children:"Submitted - Click to edit"})]},e.id)})})})]}),"PITY_DICE"===i.phase&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Dice Collections"}),(0,t.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:i.players.map(e=>(0,t.jsx)(ea,{player:e,onUpdateDiceCount:H,showControls:!0},e.id))})]}),"TRADING"===i.phase&&(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"lg:col-span-1 space-y-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Player Dice Collections"}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-3",children:i.players.map(e=>(0,t.jsx)(ea,{player:e,onUpdateDiceCount:H,showControls:!1},e.id))})]}),(0,t.jsx)("div",{className:"lg:col-span-2",children:i.currentTradingSession&&(0,t.jsx)(em,{players:i.players,tradingSession:i.currentTradingSession,onExecuteTrade:(e,s,l)=>{if(i)try{let t=function(e,s,l,t){if(!e.currentTradingSession)throw Error("No active trading session");let a=e.currentTradingSession.activePlayers.find(e=>e.playerId===s);if(!a||!a.isActive||a.tradesRemaining<=0)throw Error("Player cannot trade or has no trades remaining");let r=function(e,s,l,t){let a=e.players.find(e=>e.id===s),r=e.players.find(e=>e.id===l);if(!a||!r)throw Error("Player not found");let i=A(a,r,t);if(!i.canTrade)throw Error(i.error);let n=U(U(a,"CLEAR",a.diceCollection.clear-1),t,_(a,t)+1),c=U(U(r,t,_(r,t)-1),"CLEAR",r.diceCollection.clear+1),d={...e,players:e.players.map(e=>e.id===s?n:e.id===l?c:e)};return L(d),d}(e,s,l,t),i={fromPlayerId:s,toPlayerId:l,clearDieOffered:"clear-die-id",dieReceived:{id:"traded-die-id",type:t,sides:6}},n={...r.currentTradingSession,activePlayers:r.currentTradingSession.activePlayers.map(e=>{if(e.playerId===s){let s=e.tradesRemaining-1;return{...e,tradesRemaining:s,isActive:s>0&&!e.isDone,completedTrades:[...e.completedTrades,i]}}return e})},c=n.activePlayers.every(e=>e.isDone||e.tradesRemaining<=0);n.isComplete=c,n.canAdvance=c;let d={...r,currentTradingSession:n};return L(d),d}(i,e,s,l);n(t)}catch(e){alert(e instanceof Error?e.message:"Failed to execute trade")}},onMarkPlayerComplete:e=>{if(i)try{let s=function(e,s){if(!e.currentTradingSession)throw Error("No active trading session");let l={...e.currentTradingSession,activePlayers:e.currentTradingSession.activePlayers.map(e=>e.playerId===s?{...e,isDone:!0,isActive:!1}:e)},t=l.activePlayers.every(e=>e.isDone||e.tradesRemaining<=0);l.isComplete=t,l.canAdvance=t;let a={...e,currentTradingSession:l};return L(a),a}(i,e);n(s)}catch(e){alert(e instanceof Error?e.message:"Failed to mark player as complete")}}})})]})}),"NEW_DICE"===i.phase&&(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Player Dice Collections"}),(0,t.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:i.players.map(e=>(0,t.jsx)(ea,{player:e,onUpdateDiceCount:H,showControls:!1},e.id))})]}),(0,t.jsx)("div",{children:(0,t.jsx)(eh,{diceBag:i.diceBag,players:i.players,currentTurnPlayerId:G,onSelectDie:(e,s,l)=>{if(i)try{let l=function(e,s,l,t){let a=e.players.find(e=>e.id===s);if(!a)throw Error("Player not found");let r=l.toLowerCase().replace("_glitter","Glitter");if(e.diceBag[r]<=0)throw Error(`No ${l} dice available in bag`);let i=U(a,l,_(a,l)+1),n={...e.diceBag};n[r]=Math.max(0,n[r]-1);let c={...e,players:e.players.map(e=>e.id===s?i:e),diceBag:n};return L(c),c}(i,e,s,0),t=Y(l).sort((e,s)=>s.yellowScore-e.yellowScore),a=t.findIndex(s=>s.playerId===e)+1;a<t.length?$(t[a]?.playerId||""):$(""),n(l)}catch(e){alert(e instanceof Error?e.message:"Failed to select die")}}})})]})}),("RESULTS"===i.phase||J&&q.length>0)&&(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsxs)(o,{children:["Round ",i.currentRound," Results"]})}),(0,t.jsx)(u,{children:(0,t.jsx)("div",{className:"space-y-3",children:q.sort((e,s)=>s.roundTotal-e.roundTotal).map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 bg-muted-foreground rounded-full flex items-center justify-center text-background text-xs font-bold",children:s+1}),(0,t.jsx)("span",{className:"font-medium",children:e.playerName})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"font-bold text-primary",children:["+",e.roundTotal]}),e.yellowScore>0&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["\uD83D\uDFE1 ",e.yellowScore]})]})]},e.playerId))})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:B(i)?"Final Results":"Current Standings"}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:K.map((e,s)=>(0,t.jsx)(c,{className:0===s?"bg-primary/5 border-primary/30":"",children:(0,t.jsx)(u,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(y,{variant:0===s?"default":"secondary",children:["#",s+1]}),(0,t.jsx)("span",{className:"font-semibold",children:e.name}),e.hasPandaToken&&(0,t.jsx)(y,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"\uD83D\uDC3C"})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"font-bold text-lg",children:e.totalScore.toLocaleString()}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.pandaTokens," token",1!==e.pandaTokens?"s":""]})]})]})})},e.id))})]}),B(i)&&(0,t.jsx)(c,{className:"bg-primary/10 border-primary",children:(0,t.jsxs)(u,{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"text-4xl mb-4",children:"\uD83C\uDFC6"}),(0,t.jsxs)("div",{className:"text-2xl font-bold text-primary mb-2",children:[O(i.players)?.name," Wins!"]}),(0,t.jsxs)("div",{className:"text-muted-foreground",children:["Final Score: ",O(i.players)?.totalScore.toLocaleString()," points"]}),(0,t.jsxs)(h,{onClick:M,className:"mt-6",children:[(0,t.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),"Start New Game"]})]})})]}),p&&(0,t.jsx)(el,{open:m,onClose:()=>{x(!1),g(null)},onSubmit:e=>{if(i&&p)try{let s=function(e,s,l){let t=e.currentRound-1;for(;e.roundScores.length<=t;)e.roundScores.push([]);let a=e.players.find(e=>e.id===s);if(!a)throw Error("Player not found");let r=function(e){let s=e.map(I),l=s.filter(e=>"BLUE"===e.diceType);(s.filter(e=>"BLUE_GLITTER"===e.diceType).length>0||e.some(e=>e.hasGlitterDie))&&l.length>0&&l.forEach(e=>{e.multiplier=2,e.finalScore=2*e.rawScore,e.description=`Blue dice with Glitter: (${e.rawScore}) \xd7 2 = ${e.finalScore} points`});let t=s.reduce((e,s)=>e+s.finalScore,0),a=s.find(e=>"YELLOW"===e.diceType)?.finalScore||0;return{totalScore:t,diceScores:s,yellowScore:a}}(l),i={playerId:s,playerName:a.name,diceScores:l,roundTotal:r.totalScore,yellowScore:r.yellowScore};e.roundScores[t]=e.roundScores[t].filter(e=>e.playerId!==s),e.roundScores[t].push(i);let n={...a,yellowScoreThisRound:r.yellowScore},c={...e,players:e.players.map(e=>e.id===s?n:e)};return e.roundScores[t].length===e.players.length&&(c.phase="PITY_DICE"),L(c),c}(i,p.id,e);n(s),x(!1),g(null)}catch(e){alert(e instanceof Error?e.message:"Failed to submit scores")}},player:p,existingScores:(e=>{if(!i)return[];let s=Y(i).find(s=>s.playerId===e);return s?.diceScores||[]})(p.id)})]})})}}},function(e){e.O(0,[889,386,156,744],function(){return e(e.s=8520)}),_N_E=e.O()}]);